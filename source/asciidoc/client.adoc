[[client-applications]]
== 客户端应用程序 ==

[[show-version-in-application-list]]
=== 在应用列表中显示版本号 ===

对于 *Spring Boot* 应用程序，显示版本号最简单的办法，就是使用 `spring-boot-maven-plugin` maven插件，然后配置 goal `build-info`，之后该插件就会生成 `META-INF/build-info.properties` 文件了。更多详情请查看 http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#howto-build-info[Spring Boot 参考指南]。

对于 *非Spring Boot* 应用的话，可以在注册的时候添加 `version` 或 `build.version` 参数，这样在应用列表中就会显示版本号了。

[source,xml]
.pom.xml
----
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>build-info</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
----

要想在gradle项目中生成构建信息的话，请在 `build.gradle` 文件中添加下面的代码:
[source,groovy]
.build.gradle
----
springBoot {
	buildInfo()
}
----

[[jmx-bean-management]]
=== JMX-Bean的管理 ===

要想在admin页面中与JMX-beans进行交互，必须在应用中引入 https://jolokia.org/[Jolokia]。
由于Jolokia是基于servlet开发的，所以不支持响应式应用。
如果你使用的是 `spring-boot-admin-starter-client` 这个依赖，那么它自动会为您引入，如果没有的话，则需要手动的将Jolokia添加到依赖中。
针对Spring Boot 2.2.0版本，如果您想通过JMX暴露Spring bean的话，可能需要设置 `spring.jmx.enabled=true`。

[source,xml]
.pom.xml
----
<dependency>
    <groupId>org.jolokia</groupId>
    <artifactId>jolokia-core</artifactId>
</dependency>
----

[[logfile]]
=== 查看日志文件 ===

默认情况下，无法通过actuator接口访问日志文件，因此默认Spring Boot Admin中是看不到日志文件的。
要想启用actuator的日志文件接口，需要设置 `logging.file.path` 或 `logging.file.name` 来配置Spring Boot读写日志文件。

Spring Boot Admin会检测所有看起来像URL的东西，并将其呈现为超链接。

ANSI颜色转义语法也是支持的。
你可以自定义一个文件日志的表达式，因为Spring Boot默认情况下是不使用颜色的。

.application.properties
----
logging.file.name=/var/log/sample-boot-application.log <1>
logging.pattern.file=%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID}){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx <2>
----
<1> 定义日志文件的写入目录。启用日志文件的actuator接口。
<2> 文件日志使用自定义的ANSI颜色。

[[show-instance-tags]]
=== 显示实例的标签 ===

您可以为每个实例添加一个 `标签（Tags）` 来提高其可读性，它们会显示在应用列表以及实例试图中。
默认情况下实例不会被添加任何标签，它取决与客户端有没有向metadata元数据中添加标签或是向其它info接口中指定标签。

.application.properties
----
#使用metadata元数据
spring.boot.admin.client.instance.metadata.tags.environment=test

#使用info接口
info.tags.environment=test
----

[[spring-boot-admin-client]]
=== SBA客户端 ===

The Spring Boot Admin Client registers the application at the admin server.
This is done by periodically doing a HTTP post request to the SBA Server providing information about the application.

TIP: There are plenty of properties to influence the way how the SBA Client registers your application.
In case that doesn't fit your needs, you can provide your own `ApplicationFactory` implementation.

.Spring Boot Admin Client configuration options
|===
| Property name |Description |Default value

| spring.boot.admin.client.enabled
| Enables the Spring Boot Admin Client.
| `true`

| spring.boot.admin.client.url
| Comma separated ordered list of URLs of the Spring Boot Admin server to register at. This triggers the AutoConfiguration. *Mandatory*.
|

| spring.boot.admin.client.api-path
| Http-path of registration endpoint at your admin server.
| `"instances"`

| spring.boot.admin.client.username +
spring.boot.admin.client.password
| Username and password in case the SBA Server api is protected with HTTP Basic authentication.
|

| spring.boot.admin.client.period
| Interval for repeating the registration (in ms).
| `10,000`

| spring.boot.admin.client.connect-timeout
| Connect timeout for the registration (in ms).
| `5,000`

| spring.boot.admin.client.read-timeout
| Read timeout for the registration (in ms).
| `5,000`

| spring.boot.admin.client.auto-registration
| If set to true the periodic task to register the application is automatically scheduled after the application is ready.
| `true`

| spring.boot.admin.client.auto-deregistration
| Switch to enable auto-deregistration at Spring Boot Admin server when context is closed. If the value is unset the feature is active if a running CloudPlatform was detected.
| `null`

| spring.boot.admin.client.register-once
| If set to true the client will only register against one admin server (in order defined by `spring.boot.admin.instance.url`); if that admin server goes down, will automatically register against the next admin server. If false, will register against all admin servers.
| `true`

| spring.boot.admin.client.instance.health-url
| Health-url to register with. Can be overridden in case the reachable URL is different (e.g. Docker). Must be unique in registry.
| Guessed based on management-url and `endpoints.health.id`.

| spring.boot.admin.client.instance.management-base-url
| Base url for computing the management-url to register with. The path is inferred at runtime, and appended to the base url.
| Guessed based on `management.port`, service-url and `server.servlet-path`.

| spring.boot.admin.client.instance.management-url
| Management-url to register with. Can be overridden in case the reachable url is different (e.g. Docker).
| Guessed based on management-base-url and `management.context-path`.

| spring.boot.admin.client.instance.service-base-url
| Base url for computing the service-url to register with. The path is inferred at runtime, and appended to the base url. In Cloudfoundry environments you can switching to https like this: `spring.boot.admin.client.instance.service-base-url=https://${vcap.application.uris[0]}`
| Guessed based on hostname, `server.port`.

| spring.boot.admin.client.instance.service-url
| Service-url to register with. Can be overridden in case the reachable url is different (e.g. Docker).
| Guessed based on service-base-url and `server.context-path`.

| spring.boot.admin.client.instance.service-path
| Service-path to register with. Can be overridden in case the reachable path is different (e.g. context-path set programmatically).
| /

| spring.boot.admin.client.instance.name
| Name to register with.
| `${spring.application.name}` if set, `"spring-boot-application"` otherwise.

| spring.boot.admin.client.instance.service-host-type
| Select which information should be considered when sending the host of a service: +
    * `IP`: Uses the IP returned by `InetAddress.getHostAddress()` +
    * `HOST_NAME`: Uses the host name of a single machine returned by `InetAddress.getHostName()` +
    * `CANONICAL_HOST_NAME`: Uses the FQDN returned by `InetAddress.geCanonicalHostName()` +
    If `server.address` or `management.address` is set in the service, the value will overrule this property.
| `CANONICAL_HOST_NAME`


| spring.boot.admin.client.instance.metadata.*
| Metadata key-value-pairs to be associated with this instance.
|

| spring.boot.admin.client.instance.metadata.tags.*
| Tags as key-value-pairs to be associated with this instance.
|
|===

.Instance metadata options
|===
| Key |Value |Default value

| user.name +
user.password
| Credentials being used to access the endpoints.
|
|===
